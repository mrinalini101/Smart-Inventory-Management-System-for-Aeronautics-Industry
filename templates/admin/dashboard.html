{# templates/admin/dashboard.html #}
<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard – HAL Koraput IMS</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    /* ======================
       CSS Variables & Theming
       ====================== */
    :root {
      --font-body: 'Inter', sans-serif;
      --font-heading: 'Orbitron', sans-serif;
      /* Dark mode colors */
      --bg-base-dark: #0a0a0a;
      --bg-panel-dark: rgba(20,20,20,0.6);
      --bg-panel-hover-dark: rgba(30,30,30,0.7);
      --text-light: #e0e0e0;
      --text-muted-light: #aaa;
      /* Light mode colors */
      --bg-base-light: #f0f4f8;
      --bg-panel-light: rgba(255,255,255,0.6);
      --bg-panel-hover-light: rgba(245,245,245,0.7);
      --text-dark: #222;
      --text-muted-dark: #555;
      /* Neon accents */
      --accent-primary: #00bfff;
      --accent-secondary: #ff6600;
      --accent-success: #28a745;
      --accent-warning: #ffc107;
      --accent-danger: #dc3545;
      --accent-info: #17a2b8;
      /* Sidebar */
      --sidebar-bg-dark: #111;
      --sidebar-hover-dark: #1e1e1e;
      --sidebar-text-dark: #ddd;
      --sidebar-active-border-dark: var(--accent-primary);
      --sidebar-bg-light: #ffffff;
      --sidebar-hover-light: #e6e6e6;
      --sidebar-text-light: #333;
      --sidebar-active-border-light: var(--accent-primary);
      /* Navbar */
      --navbar-bg-dark: rgba(15,15,15,0.8);
      --navbar-bg-light: rgba(255,255,255,0.8);
      /* Glass blur strength */
      --blur-strength: 10px;
      /* Transitions */
      --transition-speed: 0.3s;
      /* Preloader */
      --preloader-bg-dark: rgba(0,0,0,0.85);
      --preloader-color-dark: var(--accent-primary);
      --preloader-bg-light: rgba(255,255,255,0.85);
      --preloader-color-light: var(--accent-primary);
      /* Background animation */
      --bg-gradient-start-dark: #0a0a0a;
      --bg-gradient-end-dark:   #1a1a1a;
      --bg-gradient-start-light: #e0e4e8;
      --bg-gradient-end-light:   #f0f4f8;
      /* Particle dot color */
      --particle-color-dark: rgba(255,255,255,0.05);
      --particle-color-light: rgba(0,0,0,0.05);
    }

    /* Apply dark/light theme based on data-theme attribute */
    html[data-theme="dark"], body[data-theme="dark"] {
      --bg-base: var(--bg-base-dark);
      --bg-panel: var(--bg-panel-dark);
      --bg-panel-hover: var(--bg-panel-hover-dark);
      --text-color: var(--text-light);
      --text-muted: var(--text-muted-light);
      --sidebar-bg: var(--sidebar-bg-dark);
      --sidebar-hover: var(--sidebar-hover-dark);
      --sidebar-text: var(--sidebar-text-dark);
      --sidebar-active-border: var(--sidebar-active-border-dark);
      --navbar-bg: var(--navbar-bg-dark);
      --preloader-bg: var(--preloader-bg-dark);
      --preloader-color: var(--preloader-color-dark);
      --bg-gradient-start: var(--bg-gradient-start-dark);
      --bg-gradient-end: var(--bg-gradient-end-dark);
      --particle-color: var(--particle-color-dark);
    }
    html[data-theme="light"], body[data-theme="light"] {
      --bg-base: var(--bg-base-light);
      --bg-panel: var(--bg-panel-light);
      --bg-panel-hover: var(--bg-panel-hover-light);
      --text-color: var(--text-dark);
      --text-muted: var(--text-muted-dark);
      --sidebar-bg: var(--sidebar-bg-light);
      --sidebar-hover: var(--sidebar-hover-light);
      --sidebar-text: var(--sidebar-text-light);
      --sidebar-active-border: var(--sidebar-active-border-light);
      --navbar-bg: var(--navbar-bg-light);
      --preloader-bg: var(--preloader-bg-light);
      --preloader-color: var(--preloader-color-light);
      --bg-gradient-start: var(--bg-gradient-start-light);
      --bg-gradient-end: var(--bg-gradient-end-light);
      --particle-color: var(--particle-color-light);
    }

    /* ======================
       Global resets & layout
       ====================== */
    html, body {
      height: 100%;
      margin: 0; padding: 0;
      font-family: var(--font-body);
      background: var(--bg-base);
      color: var(--text-color);
      overflow-x: hidden;
      position: relative;
    }
    h1,h2,h3,h4,h5,h6 {
      font-family: var(--font-heading);
      color: var(--accent-primary);
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    a:hover {
      color: var(--accent-primary);
    }

    /* ======================
       Animated Background Layers
       ====================== */
    body::before {
      content: "";
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      background-size: 200% 200%;
      animation: bgAnimate 30s ease infinite;
      z-index: -3;
    }
    @keyframes bgAnimate {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }
    body::after {
      content: "";
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.02) 0%, transparent 60%),
        radial-gradient(circle at 80% 80%, rgba(255,255,255,0.02) 0%, transparent 60%);
      background-size: 200% 200%;
      animation: overlayAnimate 40s ease infinite;
      pointer-events: none;
      z-index: -2;
    }
    @keyframes overlayAnimate {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }
    /* Particle overlay */
    .bg-particles {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background:
        repeating-linear-gradient(0deg, var(--particle-color) 0 1px, transparent 1px 20px),
        repeating-linear-gradient(90deg, var(--particle-color) 0 1px, transparent 1px 20px);
      z-index: -1;
      pointer-events: none;
    }

    /* ======================
       Preloader Overlay
       ====================== */
    #preloader {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: var(--preloader-bg);
      display: flex; align-items: center; justify-content: center;
      z-index: 2000;
    }
    .spinner-border-preloader {
      width: 3rem; height: 3rem;
      color: var(--preloader-color);
      border-width: 0.3em;
    }

    /* ======================
       Sidebar
       ====================== */
    .sidebar {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: 240px;
      background: var(--sidebar-bg);
      overflow-y: auto;        /* enable scrolling */
      transition: transform var(--transition-speed), background var(--transition-speed);
      z-index: 1500;
      border-right: 1px solid rgba(255,255,255,0.1);
    }
    @media (max-width: 992px) {
      .sidebar { transform: translateX(-260px); }
      .sidebar.show { transform: translateX(0); }
    }
    .sidebar .text-center img.logo-img {
      display: block;
      margin: 1rem auto;
      height: 36px;
      filter: none; /* ensure logo displays as-is */
    }
    /* Remove invert in dark/light; if you want different logos per theme, handle in template logic */
    .sidebar .nav-link {
      color: var(--sidebar-text);
      padding: .75rem 1rem;
      display: flex; align-items: center;
      position: relative;
      font-weight: 500;
      transition: background var(--transition-speed), color var(--transition-speed);
    }
    .sidebar .nav-link i {
      width: 20px; text-align: center; margin-right: .75rem;
      color: var(--accent-primary);
      font-size: 0.9rem; /* slightly smaller */
    }
    .sidebar .nav-link:hover {
      background: var(--sidebar-hover);
      color: var(--accent-primary);
    }
    .sidebar .nav-link.active {
      background: var(--sidebar-hover);
      color: var(--accent-primary);
    }
    .sidebar .nav-link.active::before {
      content: '';
      position: absolute; left: 0; top: 0; bottom: 0;
      width: 4px;
      background: var(--sidebar-active-border);
    }
    /* Scrollbar styling for sidebar */
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }
    .sidebar::-webkit-scrollbar-thumb {
      background-color: rgba(255,255,255,0.1);
      border-radius: 3px;
    }

    /* ======================
       Navbar
       ====================== */
    .navbar-custom {
      background: var(--navbar-bg) !important;
      margin-left: 240px;
      left: 0; right: 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      transition: margin-left var(--transition-speed), background var(--transition-speed);
      z-index: 1400;
      position: fixed; top: 0;
      /* Center contents horizontally */
      justify-content: center;
    }
    @media (max-width: 992px) {
      .navbar-custom { margin-left: 0; }
    }
    /* Centering container-fluid contents */
    .navbar-custom .container-fluid {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    /* Adjust toggler separately: place toggler at left if desired */
    .navbar-custom .navbar-toggler {
      position: absolute;
      left: 1rem;
    }
    .navbar-custom .form-control {
      border-radius: 50px 0 0 50px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(30,30,30,0.5);
      color: var(--text-color);
      max-width: 300px;
    }
    .navbar-custom .form-control::placeholder {
      color: var(--text-muted);
    }
    .navbar-custom .input-group-text {
      border-radius: 0 50px 50px 0;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(40,40,40,0.5);
      color: var(--text-color);
    }
    .navbar-custom .nav-link {
      color: var(--text-color);
      transition: opacity var(--transition-speed);
      margin-left: 1rem;
      font-size: 0.9rem;
    }
    .navbar-custom .nav-link:hover {
      opacity: 0.8;
    }
    .theme-toggle {
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--text-color);
      transition: color var(--transition-speed);
      margin-left: 1rem;
    }
    .theme-toggle:hover {
      opacity: 0.8;
    }

    /* ======================
       Main Content
       ====================== */
    .main-content {
      margin-left: 240px;
      padding: 1.5rem;
      padding-top: 64px; /* space for fixed navbar */
      transition: margin-left var(--transition-speed);
    }
    @media (max-width: 992px) {
      .main-content { margin-left: 0; }
    }
    .fade-in {
      opacity: 0;
      animation: fadeInAnim 0.8s forwards;
    }
    @keyframes fadeInAnim {
      to { opacity: 1; }
    }

    /* ======================
       Breadcrumbs
       ====================== */
    .breadcrumb-container {
      background: transparent;
      padding: 0;
      margin-bottom: 1rem;
    }
    .breadcrumb a {
      color: var(--accent-primary);
    }
    .breadcrumb .active {
      color: var(--text-muted);
    }

    /* ======================
       Glassmorphic Cards
       ====================== */
    .info-card {
      background: var(--bg-panel);
      color: var(--text-color);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 0.75rem;
      backdrop-filter: blur(var(--blur-strength));
      overflow: hidden;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed), background var(--transition-speed);
    }
    .info-card:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 24px rgba(0,191,255,0.3);
      background: var(--bg-panel-hover);
    }
    .info-card .card-body {
      padding: 1rem; /* slightly reduced */
    }
    .icon-container {
      width: 2rem; height: 2rem;  /* smaller */
      border-radius: 0.5rem;
      display: flex; align-items: center; justify-content: center;
      background-color: rgba(0,0,0,0.2);
      color: var(--accent-primary);
      margin: 0 auto 0.5rem auto;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      position: relative;
    }
    .icon-container::before {
      content: '';
      position: absolute; inset: 0;
      border-radius: inherit;
      box-shadow: 0 0 6px var(--accent-primary), 0 0 12px var(--accent-primary);
      opacity: 0.4;
      animation: pulseGlow 2s infinite;
    }
    .icon-container:hover {
      transform: scale(1.1);
      box-shadow: 0 0 8px var(--accent-primary);
    }
    @keyframes pulseGlow {
      0%,100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }
    .info-card h6 {
      margin-bottom: 0.25rem;
      font-size: 0.9rem; /* smaller */
      font-family: var(--font-heading);
      letter-spacing: 0.5px;
    }
    .info-card .subtext {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .display-6 {
      font-size: 1.5rem; /* slightly smaller */
      font-family: var(--font-heading);
      letter-spacing: 0.5px;
    }

    /* ======================
       Tables & Tooltips
       ====================== */
    .table thead {
      background: rgba(30,30,30,0.7);
      color: #fff;
    }
    .table thead th {
      border: none;
      position: sticky;
      top: 0; z-index: 2;
    }
    .table tbody tr:hover {
      background: rgba(0,191,255,0.1);
    }
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: rgba(20,20,20,0.6);
    }
    .table td, .table th {
      vertical-align: middle;
      color: var(--text-color);
    }
    .btn-action {
      color: var(--text-muted);
      transition: color var(--transition-speed), transform var(--transition-speed);
    }
    .btn-action:hover {
      color: var(--accent-primary);
      transform: scale(1.1);
    }
    .tooltip-inner {
      background-color: var(--bg-panel-dark);
      color: var(--text-color);
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(var(--blur-strength));
    }
    .tooltip.bs-tooltip-top .arrow::before {
      border-top-color: var(--bg-panel-dark);
    }

    /* ======================
       Status Badges
       ====================== */
    .badge-status-instock { background-color: var(--accent-success); color: #111; }
    .badge-status-low    { background-color: var(--accent-warning); color: #111; }
    .badge-status-out    { background-color: var(--accent-danger);  color: #fff; }

    /* ======================
       Recent Activity
       ====================== */
    .activity-item {
      display: flex; align-items: center;
      padding: 0.5rem; border-radius: 0.5rem;
      transition: background var(--transition-speed);
      background: var(--bg-panel);
      backdrop-filter: blur(var(--blur-strength));
      margin-bottom: 0.5rem;
    }
    .activity-item:hover {
      background: var(--bg-panel-hover);
    }
    .activity-item .icon {
      flex-shrink: 0;
      width: 1.5rem; height: 1.5rem; /* smaller */
      display: flex; align-items: center; justify-content: center;
      border-radius: 50%;
      background: rgba(0,0,0,0.3);
      color: var(--accent-primary);
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    .activity-item .content .time {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* ======================
       Low Stock Items
       ====================== */
    .low-stock-item {
      padding: 0.5rem;
      border-radius: 0.5rem;
      display: flex; align-items: center; justify-content: space-between;
      background: var(--bg-panel);
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(var(--blur-strength));
      transition: background var(--transition-speed), box-shadow var(--transition-speed);
      margin-bottom: 0.5rem;
    }
    .low-stock-item:hover {
      background: var(--bg-panel-hover);
      box-shadow: 0 0 8px var(--accent-warning);
    }
    .low-stock-info .name {
      font-weight: 500;
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: var(--font-heading);
    }
    .low-stock-info .qty {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    .low-stock-link {
      color: var(--accent-primary);
      transition: transform var(--transition-speed);
      font-size: 0.9rem;
    }
    .low-stock-link:hover {
      transform: scale(1.2);
    }

    /* ======================
       Floating Action Button (FAB)
       ====================== */
    .fab {
      position: fixed;
      bottom: 2rem; right: 2rem;
      width: 3rem; height: 3rem;
      background: var(--accent-primary);
      color: #111;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 12px rgba(0,191,255,0.4);
      cursor: pointer;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      z-index: 1500;
    }
    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0,191,255,0.6);
    }

    /* ======================
       Back-to-top Button
       ====================== */
    #backToTop {
      position: fixed; bottom: 1rem; right: 1rem;
      width: 2.5rem; height: 2.5rem;
      background: rgba(40,40,40,0.7);
      color: #fff;
      border-radius: 50%;
      display: none; align-items: center; justify-content: center;
      cursor: pointer; z-index: 1400;
      transition: background var(--transition-speed);
    }
    #backToTop:hover {
      background: var(--accent-primary);
    }

    /* ======================
       Modals & Offcanvas
       ====================== */
    .modal-content {
      background: var(--bg-panel);
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(var(--blur-strength));
      color: var(--text-color);
    }
    .modal-header, .modal-footer {
      border-color: rgba(255,255,255,0.1);
    }
    .modal-body {
      background: var(--bg-base);
    }
    .offcanvas-body {
      background: var(--bg-base);
      color: var(--text-color);
    }

    /* ======================
       Button overrides
       ====================== */
    .btn-primary {
      background-color: var(--accent-primary);
      border-color: var(--accent-primary);
      color: #111;
    }
    .btn-primary:hover {
      background-color: #009acd;
      border-color: #009acd;
    }
    .btn-outline-primary {
      color: var(--accent-primary);
      border-color: var(--accent-primary);
    }
    .btn-outline-primary:hover {
      background-color: var(--accent-primary);
      color: #111;
    }
    .btn-warning {
      background-color: var(--accent-warning);
      border-color: var(--accent-warning);
      color: #111;
    }
    .btn-warning:hover {
      background-color: #e65c00;
      border-color: #e65c00;
    }
    .btn-secondary {
      background-color: rgba(40,40,40,0.7);
      border-color: rgba(40,40,40,0.7);
      color: #ccc;
    }
    .btn-secondary:hover {
      background-color: rgba(60,60,60,0.8);
      border-color: rgba(60,60,60,0.8);
    }
  </style>
</head>
<body>
  <!-- Preloader -->
  <div id="preloader">
    <div class="spinner-border spinner-border-preloader" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  <!-- Particle overlay -->
  <div class="bg-particles"></div>

  {# Determine current endpoint for active-link logic #}
  {% set ep = request.endpoint|default('') %}

  <!-- Sidebar -->
  <nav class="sidebar d-none d-lg-block">
    <div class="text-center mb-4">
      <a href="{{ url_for('admin.dashboard') }}">
        <img src="{{ url_for('static', filename='img/hal-logo.png') }}" alt="HAL Logo" class="logo-img">
      </a>
    </div>
    <ul class="nav flex-column mb-4">
      <!-- Dashboard -->
      <li class="nav-item">
        <a class="nav-link {% if ep == 'admin.dashboard' %}active{% endif %}"
           href="{{ url_for('admin.dashboard') }}">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
      </li>
      <!-- Categories -->
      <li class="nav-item">
        <a class="nav-link {% if ep == 'categories.list_categories' %}active{% endif %}"
           href="{{ url_for('categories.list_categories') }}">
          <i class="fas fa-layer-group"></i> Categories
        </a>
      </li>
      <!-- Inventory Types -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('inventory_types.') %}active{% endif %}"
           href="{{ url_for('inventory_types.list_types') }}">
          <i class="fas fa-tags"></i> Item Types
        </a>
      </li>
      <!-- Units of Measure -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('uom.') %}active{% endif %}"
           href="{{ url_for('uom.list_uom') }}">
          <i class="fas fa-balance-scale"></i> Units
        </a>
      </li>
      <!-- Suppliers -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('suppliers.') %}active{% endif %}"
           href="{{ url_for('suppliers.list_suppliers') }}">
          <i class="fas fa-truck"></i> Suppliers
        </a>
      </li>
      <!-- Items -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('items.') %}active{% endif %}"
           href="{{ url_for('items.list_items') }}">
          <i class="fas fa-boxes"></i> Items
        </a>
      </li>
      <!-- Orders -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('orders.') %}active{% endif %}"
           href="{{ url_for('orders.list_orders') }}">
          <i class="fas fa-shopping-cart"></i> Orders
        </a>
      </li>
      <!-- Kits -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('kits.') %}active{% endif %}"
           href="{{ url_for('kits.list_kits') }}">
          <i class="fas fa-cubes"></i> Kits
        </a>
      </li>
      <!-- Consumption Logs -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('consumption.') %}active{% endif %}"
           href="{{ url_for('consumption.list_logs') }}">
          <i class="fas fa-chart-line"></i> Consumption
        </a>
      </li>
      <!-- Analytics -->
      <li class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center {% if ep.startswith('analytics.') %}active{% endif %}"
           data-bs-toggle="collapse" href="#submenuAnalytics" role="button" aria-expanded="false" aria-controls="submenuAnalytics">
          <span><i class="fas fa-chart-bar"></i> Analytics</span>
          <i class="fas fa-chevron-down small"></i>
        </a>
        <div class="collapse submenu {% if ep.startswith('analytics.') %}show{% endif %}" id="submenuAnalytics">
          <ul class="nav flex-column ps-3">
            <li class="nav-item">
              <a class="nav-link {% if ep=='analytics.dashboard' %}active{% endif %}"
                 href="{{ url_for('analytics.dashboard') }}">Overview</a>
            </li>
            {# More analytics sub-links if any #}
          </ul>
        </div>
      </li>
      <!-- Search -->
      <li class="nav-item">
        <a class="nav-link {% if ep.startswith('search.') %}active{% endif %}"
           href="{{ url_for('search.search') }}">
          <i class="fas fa-search"></i> Search
        </a>
      </li>
      <!-- Users -->
      <li class="nav-item">
        <a class="nav-link {% if ep=='admin.list_users' %}active{% endif %}"
           href="{{ url_for('admin.list_users') }}">
          <i class="fas fa-users"></i> Users
        </a>
      </li>
    </ul>
  </nav>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
    <div class="container-fluid">
      <!-- Sidebar toggler -->
      <button class="navbar-toggler" type="button" id="sidebarToggleBtn" aria-label="Toggle sidebar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Breadcrumbs (centered by container-fluid flex) -->
      <nav aria-label="breadcrumb" class="d-none d-md-block">
        <ol class="breadcrumb breadcrumb-container mb-0">
          <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
        </ol>
      </nav>

      <!-- Search form -->
      <form class="d-flex ms-3 flex-grow-1 justify-content-center" action="{{ url_for('search.search') }}" method="get">
        <div class="input-group">
          <input class="form-control" type="search" name="q" placeholder="Search..." aria-label="Search">
          <button class="btn btn-light" type="submit"><i class="fas fa-search"></i></button>
        </div>
      </form>

      <!-- Dark mode toggle & notifications & user dropdown -->
      <ul class="navbar-nav align-items-center">
        <!-- Dark mode toggle -->
        <li class="nav-item me-3">
          <span id="themeToggle" class="theme-toggle" title="Toggle dark/light mode"><i class="fas fa-moon"></i></span>
        </li>
        <!-- Notifications dropdown -->
        <li class="nav-item dropdown me-3">
          <a class="nav-link position-relative" href="#" id="notifDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-bell"></i>
            {% if notifications is defined and notifications|length>0 %}
              <span class="badge bg-danger rounded-circle position-absolute top-0 start-100 translate-middle p-1">{{ notifications|length }}</span>
            {% endif %}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notifDropdown"
              style="width:300px; backdrop-filter: blur(var(--blur-strength)); background: var(--bg-panel); border:1px solid rgba(255,255,255,0.1);">
            <li class="dropdown-header">Notifications</li>
            {% if notifications is defined and notifications %}
              {% for notif in notifications %}
                <li>
                  <a class="dropdown-item d-flex align-items-start" href="{{ notif.link }}">
                    <div class="me-2"><i class="{{ notif.icon_class }}"></i></div>
                    <div>
                      <div>{{ notif.title }}</div>
                      <div class="small text-muted">{{ notif.time_ago }}</div>
                    </div>
                  </a>
                </li>
                {% if not loop.last %}
                  <li><hr class="dropdown-divider"></li>
                {% endif %}
              {% endfor %}
              <li><hr class="dropdown-divider"></li>
              <li class="text-center"><a class="dropdown-item" href="{{ url_for('notifications.view_all') }}">View all</a></li>
            {% else %}
              <li><span class="dropdown-item-text text-muted">No notifications.</span></li>
            {% endif %}
          </ul>
        </li>
        <!-- User dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <img src="{{ current_user.avatar_url or url_for('static', filename='img/avatar.jpg') }}"
                 alt="Avatar" class="rounded-circle me-2" width="28" height="28"
                 style="object-fit:cover; border:1px solid rgba(255,255,255,0.2);">
            <span>{{ current_user.name }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end"
              aria-labelledby="userDropdown"
              style="backdrop-filter: blur(var(--blur-strength)); background: var(--bg-panel); border:1px solid rgba(255,255,255,0.1);">
            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Offcanvas Sidebar for Mobile -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileSidebar" aria-labelledby="mobileSidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileSidebarLabel">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link {% if ep=='admin.dashboard' %}active{% endif %}" href="{{ url_for('admin.dashboard') }}">
            <i class="fas fa-tachometer-alt me-2"></i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep=='categories.list_categories' %}active{% endif %}"
             href="{{ url_for('categories.list_categories') }}">
            <i class="fas fa-layer-group me-2"></i> Categories
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('inventory_types.') %}active{% endif %}"
             href="{{ url_for('inventory_types.list_types') }}">
            <i class="fas fa-tags me-2"></i> Item Types
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('uom.') %}active{% endif %}" href="{{ url_for('uom.list_uom') }}">
            <i class="fas fa-balance-scale me-2"></i> Units
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('suppliers.') %}active{% endif %}" href="{{ url_for('suppliers.list_suppliers') }}">
            <i class="fas fa-truck me-2"></i> Suppliers
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('items.') %}active{% endif %}" href="{{ url_for('items.list_items') }}">
            <i class="fas fa-boxes me-2"></i> Items
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('orders.') %}active{% endif %}" href="{{ url_for('orders.list_orders') }}">
            <i class="fas fa-shopping-cart me-2"></i> Orders
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('kits.') %}active{% endif %}" href="{{ url_for('kits.list_kits') }}">
            <i class="fas fa-cubes me-2"></i> Kits
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('consumption.') %}active{% endif %}" href="{{ url_for('consumption.list_logs') }}">
            <i class="fas fa-chart-line me-2"></i> Consumption
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('analytics.') %}active{% endif %}" href="{{ url_for('analytics.dashboard') }}">
            <i class="fas fa-chart-bar me-2"></i> Analytics
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep.startswith('search.') %}active{% endif %}" href="{{ url_for('search.search') }}">
            <i class="fas fa-search me-2"></i> Search
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if ep=='admin.list_users' %}active{% endif %}" href="{{ url_for('admin.list_users') }}">
            <i class="fas fa-users me-2"></i> Users
          </a>
        </li>
      </ul>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content fade-in">
    <div class="container-fluid">
      {# Flash messages #}
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mt-3">
            {% for category, msg in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ msg }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Summary Cards Row 1 -->
      <div class="row g-3 mb-4">
        <!-- Total Users -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-users"></i></div>
              <h6 class="card-title">Total Users</h6>
              <p class="display-6 count-up" data-target="{{ total_users }}">0</p>
              <div class="subtext">Registered users</div>
            </div>
          </div>
        </div>
        <!-- Categories -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-layer-group"></i></div>
              <h6 class="card-title">Categories</h6>
              <p class="display-6 count-up" data-target="{{ cat_count }}">0</p>
              <div class="subtext">Material categories</div>
            </div>
          </div>
        </div>
        <!-- Item Types -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-tags"></i></div>
              <h6 class="card-title">Item Types</h6>
              <p class="display-6 count-up" data-target="{{ type_count }}">0</p>
              <div class="subtext">Inventory types</div>
            </div>
          </div>
        </div>
        <!-- Units of Measure -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-balance-scale"></i></div>
              <h6 class="card-title">Units of Measure</h6>
              <p class="display-6 count-up" data-target="{{ uom_count }}">0</p>
              <div class="subtext">UoM entries</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards Row 2 -->
      <div class="row g-3 mb-4">
        <!-- Suppliers -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-truck"></i></div>
              <h6 class="card-title">Suppliers</h6>
              <p class="display-6 count-up" data-target="{{ sup_count }}">0</p>
              <div class="subtext">Registered suppliers</div>
            </div>
          </div>
        </div>
        <!-- Items -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-boxes"></i></div>
              <h6 class="card-title">Items</h6>
              <p class="display-6 count-up" data-target="{{ item_count }}">0</p>
              <div class="subtext">Total items</div>
            </div>
          </div>
        </div>
        <!-- Orders -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-shopping-cart"></i></div>
              <h6 class="card-title">Orders</h6>
              <p class="display-6 count-up" data-target="{{ order_count }}">0</p>
              <div class="subtext">Placed orders</div>
            </div>
          </div>
        </div>
        <!-- Kits -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-cubes"></i></div>
              <h6 class="card-title">Kits</h6>
              <p class="display-6 count-up" data-target="{{ kit_count }}">0</p>
              <div class="subtext">Defined kits</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards Row 3 -->
      <div class="row g-3 mb-4">
        <!-- Consumption Logs -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-chart-line"></i></div>
              <h6 class="card-title">Consumption Logs</h6>
              <p class="display-6 count-up" data-target="{{ consumption_count }}">0</p>
              <div class="subtext">Logged consumptions</div>
            </div>
          </div>
        </div>
        <!-- In Stock -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-check-circle"></i></div>
              <h6 class="card-title">In Stock</h6>
              <p class="display-6 count-up" data-target="{{ in_stock_count }}">0</p>
              <div class="subtext">Above threshold</div>
            </div>
          </div>
        </div>
        <!-- Low Stock -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-exclamation-triangle"></i></div>
              <h6 class="card-title">Low Stock</h6>
              <p class="display-6 count-up" data-target="{{ low_stock_count }}">0</p>
              <div class="subtext">Needs restock</div>
            </div>
          </div>
        </div>
        <!-- Out of Stock -->
        <div class="col-sm-6 col-lg-3">
          <div class="card info-card text-center">
            <div class="card-body">
              <div class="icon-container"><i class="fas fa-times-circle"></i></div>
              <h6 class="card-title">Out of Stock</h6>
              <p class="display-6 count-up" data-target="{{ out_stock_count }}">0</p>
              <div class="subtext">Zero quantity</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Combined Charts & Recent Users -->
      <div class="row mb-4">
        {% if counts_by_role %}
          <div class="col-lg-6 mb-3">
            <div class="card info-card h-100">
              <div class="card-header"><h5 class="mb-0">User Role Distribution</h5></div>
              <div class="card-body d-flex align-items-center justify-content-center">
                <canvas id="roleChart" style="max-height:300px; width:100%;"></canvas>
              </div>
            </div>
          </div>
        {% endif %}
        <div class="col-lg-6 mb-3">
          <div class="card info-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Recent Users</h5>
              <a href="{{ url_for('admin.list_users') }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-users me-1"></i> View All
              </a>
            </div>
            <div class="table-responsive" style="max-height:320px; overflow-y:auto;">
              <table class="table table-striped mb-0">
                <thead>
                  <tr>
                    <th>Emp ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Joined</th>
                  </tr>
                </thead>
                <tbody>
                  {% for u in recent_users %}
                    <tr>
                      <td>{{ u.emp_id }}</td>
                      <td>{{ u.first_name }} {{ u.last_name }}</td>
                      <td>{{ u.email }}</td>
                      <td>{{ u.role.title() }}</td>
                      <td>
                        <span class="badge bg-{{ 'success' if u.is_active else 'secondary' }}">
                          {{ 'Active' if u.is_active else 'Inactive' }}
                        </span>
                      </td>
                      <td>{{ u.created_at.strftime('%Y-%m-%d') }}</td>
                    </tr>
                  {% else %}
                    <tr>
                      <td colspan="6" class="text-center text-muted">No recent users.</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Stock Distribution, Recent Activity, Low Stock Items -->
      <div class="row">
        {% if counts_by_stock %}
          <div class="col-lg-4 mb-4">
            <div class="card info-card h-100">
              <div class="card-header"><h5 class="mb-0">Stock Distribution</h5></div>
              <div class="card-body d-flex align-items-center justify-content-center">
                <canvas id="stockChart" style="max-height:200px; width:100%;"></canvas>
              </div>
            </div>
          </div>
        {% endif %}
        <div class="col-lg-4 mb-4">
          <div class="card info-card h-100">
            <div class="card-header"><h5 class="mb-0">Recent Activity</h5></div>
            <div class="card-body" style="max-height:300px; overflow-y:auto;">
              {% if recent_activity is defined and recent_activity %}
                {% for act in recent_activity %}
                  <a href="{{ act.link or '#' }}" class="d-block text-decoration-none">
                    <div class="activity-item" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ act.description }}">
                      <div class="icon"><i class="{{ act.icon_class }}"></i></div>
                      <div class="content">
                        <div class="small">{{ act.description }}</div>
                        <div class="time">{{ act.time_ago }}</div>
                      </div>
                    </div>
                  </a>
                {% endfor %}
              {% else %}
                <p class="text-center text-muted">No recent activity.</p>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-lg-4 mb-4">
          <div class="card info-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Low Stock Items</h5>
              <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#lowStockModal">
                <i class="fas fa-exclamation-triangle me-1"></i> View All
              </button>
            </div>
            <div class="card-body" style="max-height:300px; overflow-y:auto;">
              {% if low_stock_items is defined and low_stock_items %}
                {% for item in low_stock_items %}
                  <div class="low-stock-item" data-bs-toggle="tooltip" data-bs-placement="top"
                       title="Threshold: {{ item.low_stock_threshold }}">
                    <div class="low-stock-info">
                      <div class="name">{{ item.part_no or item.name or ('Item ' ~ item.id) }}</div>
                      <div class="qty">Qty: {{ item.quantity }}</div>
                    </div>
                    <div class="progress" style="flex:1; margin:0 0.5rem; height:0.4rem; background:rgba(255,255,255,0.1);">
                      {% set pct = (item.low_stock_threshold and (item.quantity/item.low_stock_threshold)*100) or 0 %}
                      <div class="progress-bar bg-warning" role="progressbar"
                           style="width:{{ pct|round(0) }}%;"
                           aria-valuenow="{{ item.quantity }}" aria-valuemin="0"
                           aria-valuemax="{{ item.low_stock_threshold }}"></div>
                    </div>
                    <a href="{% if 'items.view_item' in current_app.view_functions %}{{ url_for('items.view_item', item_id=item.id) }}{% else %}#{% endif %}"
                       class="low-stock-link"><i class="fas fa-arrow-right"></i></a>
                  </div>
                {% endfor %}
              {% else %}
                <p class="text-center text-muted">No low stock items.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Low Stock Modal -->
  <div class="modal fade" id="lowStockModal" tabindex="-1" aria-labelledby="lowStockModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="lowStockModalLabel"><i class="fas fa-exclamation-triangle me-2"></i>All Low Stock Items</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          {% if low_stock_items is defined and low_stock_items %}
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr><th>Part No / Name</th><th>Quantity</th><th>Threshold</th><th>Progress</th><th>Action</th></tr>
                </thead>
                <tbody>
                  {% for item in low_stock_items %}
                    <tr>
                      <td>{{ item.part_no or item.name or ('Item ' ~ item.id) }}</td>
                      <td>{{ item.quantity }}</td>
                      <td>{{ item.low_stock_threshold }}</td>
                      <td style="min-width:120px;">
                        {% set pct = (item.low_stock_threshold and (item.quantity/item.low_stock_threshold)*100) or 0 %}
                        <div class="progress" style="height:0.6rem; background:rgba(255,255,255,0.1);">
                          <div class="progress-bar bg-warning" role="progressbar" style="width:{{ pct|round(0) }}%;" aria-valuenow="{{ item.quantity }}" aria-valuemin="0" aria-valuemax="{{ item.low_stock_threshold }}"></div>
                        </div>
                      </td>
                      <td>
                        {% if 'items.view_item' in current_app.view_functions %}
                          <a href="{{ url_for('items.view_item', item_id=item.id) }}" class="btn btn-sm btn-primary">View</a>
                        {% else %}
                          <span class="text-muted">—</span>
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="text-end mt-3">
              {% if 'items.low_stock_list' in current_app.view_functions %}
                <a href="{{ url_for('items.low_stock_list') }}" class="btn btn-primary">View Full List</a>
              {% endif %}
            </div>
          {% else %}
            <p class="text-center text-muted mb-0">No low stock items.</p>
          {% endif %}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Back-to-top Button -->
  <div id="backToTop"><i class="fas fa-chevron-up"></i></div>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

  <script>
    // ======================
    // Preloader hide on load
    // ======================
    window.addEventListener('load', function(){
      const pre = document.getElementById('preloader');
      if(pre){
        pre.style.opacity = '0';
        setTimeout(()=> pre.remove(), 600);
      }
    });

    // ======================
    // Sidebar toggle (mobile)
    // ======================
    const sidebar = document.querySelector('.sidebar');
    const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
    const mobileSidebarEl = document.getElementById('mobileSidebar');
    let mobileSidebar;
    if(mobileSidebarEl){
      mobileSidebar = new bootstrap.Offcanvas(mobileSidebarEl);
    }
    if(sidebarToggleBtn){
      sidebarToggleBtn.addEventListener('click', ()=>{
        if(window.innerWidth<992 && mobileSidebar){
          mobileSidebar.toggle();
        } else if (sidebar){
          sidebar.classList.toggle('show');
        }
      });
    }

    // ======================
    // Dark/Light Mode Toggle
    // ======================
    (function(){
      const docEl = document.documentElement;
      const toggle = document.getElementById('themeToggle');
      if(!toggle) return;
      const icon = toggle.querySelector('i');
      const stored = localStorage.getItem('theme');
      function applyTheme(theme){
        docEl.setAttribute('data-theme', theme);
        if(theme==='dark'){
          icon.classList.remove('fa-moon');
          icon.classList.add('fa-sun');
        } else {
          icon.classList.remove('fa-sun');
          icon.classList.add('fa-moon');
        }
      }
      if(stored==='light'){
        applyTheme('light');
      } else if(stored==='dark'){
        applyTheme('dark');
      } else {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyTheme(prefersDark ? 'dark' : 'light');
      }
      toggle.addEventListener('click', ()=>{
        const current = docEl.getAttribute('data-theme');
        const next = current==='light' ? 'dark' : 'light';
        applyTheme(next);
        localStorage.setItem('theme', next);
      });
    })();

    // ======================
    // Count-up animation & Chart initializations & Tooltips
    // ======================
    document.addEventListener('DOMContentLoaded', ()=>{
      // Count-up
      const counters = document.querySelectorAll('.count-up');
      counters.forEach(counter=>{
        const target = +counter.getAttribute('data-target');
        let start = 0;
        const duration = 1500;
        const stepTime = Math.max(20, duration/(target||1));
        function updateCount(){
          start += 1;
          counter.textContent = start;
          if(start < target){
            setTimeout(updateCount, stepTime);
          } else {
            counter.textContent = target;
          }
        }
        updateCount();
      });
      // Tooltips
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(el=>new bootstrap.Tooltip(el));

      // Role distribution chart
      {% if counts_by_role %}
      const ctxRole = document.getElementById('roleChart');
      if(ctxRole){
        new Chart(ctxRole, {
          type:'doughnut',
          data:{
            labels: {{ counts_by_role.keys()|list|tojson }},
            datasets:[{
              data: {{ counts_by_role.values()|list|tojson }},
              backgroundColor:[
                'rgba(0,191,255,0.7)',
                'rgba(40,167,69,0.7)',
                'rgba(255,102,0,0.7)',
                'rgba(220,53,69,0.7)',
                'rgba(100,100,100,0.7)'
              ]
            }]
          },
          options:{
            responsive:true,
            plugins:{ legend:{ position:'bottom', labels:{ color:getComputedStyle(document.body).color }}},
            animation:{ animateScale:true }
          }
        });
      }
      {% endif %}

      // Stock distribution chart
      {% if counts_by_stock %}
      const ctxStock = document.getElementById('stockChart');
      if(ctxStock){
        new Chart(ctxStock, {
          type:'doughnut',
          data:{
            labels: {{ counts_by_stock.keys()|list|tojson }},
            datasets:[{
              data: {{ counts_by_stock.values()|list|tojson }},
              backgroundColor:[
                'rgba(40,167,69,0.7)',
                'rgba(255,102,0,0.7)',
                'rgba(220,53,69,0.7)'
              ]
            }]
          },
          options:{
            responsive:true,
            plugins:{ legend:{ position:'bottom', labels:{ color:getComputedStyle(document.body).color }}},
            animation:{ animateScale:true }
          }
        });
      }
      {% endif %}
    });

    // ======================
    // Back-to-top Button
    // ======================
    const backToTopBtn = document.getElementById('backToTop');
    window.addEventListener('scroll', ()=>{
      if(window.scrollY>300){
        backToTopBtn.style.display='flex';
      } else {
        backToTopBtn.style.display='none';
      }
    });
    if(backToTopBtn){
      backToTopBtn.addEventListener('click', ()=>{ window.scrollTo({ top:0, behavior:'smooth' }); });
    }
  </script>
</body>
</html>
